Description: fix denial of service via buffer overflow
Origin: upstream, http://tug.org/mailman/htdig/tex-live/2009-August/021998.html
Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=520920

--- texk/web2c/bibtex.ch	2010-05-10 10:54:31.891153936 +0200
+++ texk/web2c/bibtex.ch.oden	2010-05-10 11:08:02.694156832 +0200
@@ -1134,6 +1134,15 @@ while ((ex_buf_xptr < ex_buf_ptr) and
 @y
 @z
 
+% Forgot to check for pool overflow here.  Triggered by test case linked
+% from http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=520920.
+@x
+while (sp_ptr < sp_end) do                      {shift the substring}
+@y
+str_room(sp_end - sp_ptr);
+while (sp_ptr < sp_end) do                      {shift the substring}
+@z
+
 % [459] Eliminate unreferenced statement label, because `undefined' is
 % now a constant expression that is not evaluated at the Web level. If
 % this label were ever required, it could be replaced by the constant
